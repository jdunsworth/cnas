<!doctype html>

<html lang="en">
  <head>
    <title>Cajun Navy Alert System</title>
    <meta name="description" content="Cajun Navy Alert System">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">


    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js" integrity="sha256-4iQZ6BVL4qNKlQ27TExEhBN1HFPvAvAMbFavKKosSWQ=" crossorigin="anonymous"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


    <style>
      body {
        background: #E0E0E0;  /* fallback for old browsers */
      }
    </style>

    <script>

      let nwsRefreshTimer;
      $(document).ready(function() {
        retrieveNWSAlerts();
      });

      function retrieveNWSAlerts(){

        clearTimeout(nwsRefreshTimer);

        $('#alertLoading').show();
        $('#alertList').hide();
        $('#getAlertBtn').addClass('btn-disabled').attr('disabled','disabled');
        $('#alertList').empty();

        $.get('/nws/alerts', function(data) {

          $.each(data.weatherAlerts, function(alertIndex, alert) {

            let alertMessage = 'A ' + alert.event + ' has been issued on ';
            alertMessage += moment(alert.dates.effective).format('MMMM Do [at] hh:mm A');
            alertMessage += (alert.dates.ends) ? ' until ' + moment(alert.dates.ends).format('MMMM Do [at] hh:mm A') : '';
            alertMessage += ' affecting ';
            alertMessage += (alert.area.split(';').length > 1) ? ' areas of ' + alert.area : alert.area;

            $('#alertList').append('<li class="list-group-item" onclick="fillAlert(\'' + alertMessage + '\')">' + alertMessage + '</li>')
          });

          $('#alertList').show();
          $('#alertLoading').hide();
          $('#getAlertBtn').removeClass('btn-disabled').removeAttr('disabled','disabled');
        });

        setTimeout(retrieveNWSAlerts, 60000);
      }

      function fillAlert(message){
        $('#alertText').val(message);
      }

      function sendAlert(){
        var alertText = $('#alertText').val();
        var alertPreamble = $('#alertPreamble').val();
        var alertPostamble = $('#alertPreaalertPostamblemble').val();

        if(alertText.length > 0){
          $.get('/alert/say', { alert: alertText, preamble: alertPreamble, postamble: alertPostamble });
        } else {
          alert('You must include some text to send as your alert.')
        }

      }
    </script>

  </head>

  <body >
    <div class="container">
      <div class="row">
        <div class="col-sm">

          <h3 class="text-center">Cajun Navy Audio Alerts</h3>


          <div class="card" style="margin-top: 15px;">

            <div class="card-body">

              <div class="form-group">
                <label for="alertText">Alert Text</label>
                <input type="text" class="form-control" id="alertText" placeholder="Alert Text..." value="This is a test">
              </div>


              <div class="row">
                <div class="col-sm-12 col-md-6">
                  <div class="form-group">
                    <label for="alertPreamble">Alert Preamble Tone</label>
                    <select class="form-control" id="alertPreamble">
                      <option value="">No Preamble Tone</option>
                      <option value="alert">Three Slow Beeps</option>
                      <option value="beeps" selected>Three Fast Beeps</option>
                      <option value="hilo">Hi-Lo</option>
                      <option value="warning">Warning (LONG)</option>
                    </select>
                  </div>
                </div>
                <div class="col-sm-12 col-md-6">

                  <div class="form-group">
                    <label for="alertPostamble">Alert Postamble Tone</label>
                    <select class="form-control" id="alertPostamble">
                      <option value="" selected>No Preamble Tone</option>
                      <option value="alert">Three Slow Beeps</option>
                      <option value="beeps">Three Fast Beeps</option>
                      <option value="hilo">Hi-Lo</option>
                      <option value="warning">Warning (LONG)</option>
                    </select>
                  </div>

                </div>
              </div>


              <button class="btn btn-success" type="button" name="action" onclick="sendAlert();">Send Alert</button>

            </div>
          </div>

          <div class="card" style="margin-top: 15px;">
            <div class="card-body">
              <h4 class="card-title">
                National Weather Service Alerts
                <button class="btn btn-success float-right" id="getAlertBtn" type="button" onclick="retrieveNWSAlerts();">Get Alerts</button>
              </h4>
            </div>

            <div id="alertLoading" class="p-5" style="display:none;">
              <h3 class="text-center">Retrieving Alerts...</h3>
            </div>

            <ul id="alertList" class="list-group list-group-flush" style="display:none;">
              <li class="list-group-item">Cras justo odio</li>
              <li class="list-group-item">Dapibus ac facilisis in</li>
              <li class="list-group-item">Vestibulum at eros</li>
            </ul>


          </div>




        </div>
      </div>
    </div>
  </body>
</html>
